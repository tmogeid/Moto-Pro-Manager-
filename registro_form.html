<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registro - Moto Pro Manager</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="style.css">
    <script src="js/i18n.js"></script>
    <script src="background-changer.js"></script>
    <script src="cookie-consent.js"></script>
    <script src="https://www.google.com/recaptcha/api.js?render=6LcmYx0fAAAAAPV_0T0nefqy2LRMq1myiGQ7P10V"></script>
</head>
<body>
    <!-- Header con logo -->
    <div class="page-header">
        <img src="logo.png" alt="Moto Pro Manager" class="logo-serie">
    </div>
    
    <div class="card">
        <h2>√öNETE A LA PARRILLA</h2>
        <div id="errorMsg" class="error-banner" style="display:none;">
            ‚ö†Ô∏è <span id="errorText"></span>
        </div>
        <form id="regForm" action="/registro" method="POST">
            <input type="text" name="username" placeholder="Nombre de usuario" required>
            <input type="text" name="escuderia" placeholder="Nombre de tu Escuder√≠a" required>
            <input type="email" name="email" placeholder="Correo electr√≥nico" required>
            
            <div class="password-field">
                <input type="password" id="pass1" name="password" placeholder="Contrase√±a" required>
                <button type="button" class="toggle-password" onclick="togglePassword('pass1', this)">üëÅÔ∏è</button>
            </div>
            
            <ul class="validator-list">
                <li id="req-length">M√≠nimo 8 caracteres</li>
                <li id="req-minu">Una min√∫scula</li>
                <li id="req-upper">Una may√∫scula</li>
                <li id="req-number">Un n√∫mero</li>
                <li id="req-symbol">Un s√≠mbolo o puntuaci√≥n</li>
            </ul>
            <div class="password-field">
                <input type="password" id="pass2" placeholder="Confirmar contrase√±a" required disabled>
                <button type="button" class="toggle-password" onclick="togglePassword('pass2', this)">üëÅÔ∏è</button>
            </div>
            <p id="match-msg" class="match-msg"></p>
            <button type="submit" id="btnSubmit" class="btn-rojo" disabled>CREAR CUENTA</button>
        </form>
        <div class="footer-links">
            <p><a href="index.html">¬øYa tienes cuenta? Inicia sesi√≥n</a></p>
        </div>
    </div>
    <script>
        function togglePassword(inputId, btn) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
                btn.textContent = 'üôà';
            } else {
                input.type = 'password';
                btn.textContent = 'üëÅÔ∏è';
            }
        }
        const p1 = document.getElementById('pass1');
        const p2 = document.getElementById('pass2');
        const btn = document.getElementById('btnSubmit');
        const msg = document.getElementById('match-msg');
        const form = document.getElementById('regForm');
        p1.addEventListener('input', () => {
            p1.value = p1.value.trim();
            const val = p1.value;
            const res = {
                len: val.length >= 8,
                min: /[a-z]/.test(val),
                up: /[A-Z]/.test(val),
                num: /[0-9]/.test(val),
                sym: /[!@#$%^&*(),.?":{}|<>_\-+/=~\[\]\\]/.test(val)
            };
            document.getElementById('req-length').className = res.len ? 'valid' : '';
            document.getElementById('req-minu').className = res.min ? 'valid' : '';
            document.getElementById('req-upper').className = res.up ? 'valid' : '';
            document.getElementById('req-number').className = res.num ? 'valid' : '';
            document.getElementById('req-symbol').className = res.sym ? 'valid' : '';
            const allOk = Object.values(res).every(Boolean);
            p2.disabled = !allOk;
            if(!allOk) { p2.value = ''; msg.style.display = 'none'; }
            checkMatch();
        });
        p2.addEventListener('input', () => {
            p2.value = p2.value.trim();
            checkMatch();
        });
        function checkMatch() {
            if (!p2.value || p2.disabled) { btn.disabled = true; return; }
            msg.style.display = 'block';
            if (p1.value === p2.value) {
                msg.style.color = '#2ecc71';
                msg.innerText = '‚úî Las contrase√±as coinciden';
                btn.disabled = false;
            } else {
                msg.style.color = '#e63946';
                msg.innerText = '‚úñ No coinciden';
                btn.disabled = true;
            }
        }
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            grecaptcha.ready(() => {
                grecaptcha.execute('6LcmYx0fAAAAAPV_0T0nefqy2LRMq1myiGQ7P10V', {action: 'registro'}).then((token) => {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'captchaToken';
                    input.value = token;
                    form.appendChild(input);
                    form.submit();
                });
            });
        });
        // Mostrar error si viene en la URL
        const params = new URLSearchParams(window.location.search);
        if (params.has('error')) {
            const errorType = params.get('error');
            const errorMsg = document.getElementById('errorMsg');
            const errorText = document.getElementById('errorText');
            if (errorType === 'password') {
                errorText.innerText = 'La contrase√±a debe tener al menos 8 caracteres, una may√∫scula, una min√∫scula y un n√∫mero.';
                errorMsg.style.display = 'block';
            } else if (errorType === 'captcha') {
                errorText.innerText = 'No hemos podido verificar que eres humano. Int√©ntalo de nuevo.';
                errorMsg.style.display = 'block';
            }
        }
    </script>
    <script src="preload-fondos.js"></script>
</body>
</html>
